<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifesteal SMP Status</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .progress-bar-bg {
            background: rgba(255, 255, 255, 0.1);
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        
        <!-- Header Section -->
        <div class="glass-panel rounded-2xl p-6 mb-8 flex flex-col md:flex-row items-center gap-6 shadow-xl relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-20 pointer-events-none">
                <i class="fas fa-server text-9xl"></i>
            </div>
            
            <!-- Server Icon -->
            <div class="relative group">
                <img id="server-icon" src="https://api.mcsrvstat.us/icon/lifestealbestsmp.playsmp.xyz" 
                     onerror="this.src='https://via.placeholder.com/128/1e293b/ffffff?text=SMP'"
                     class="w-32 h-32 rounded-2xl shadow-lg border-4 border-slate-700 transition-transform duration-300 group-hover:scale-105 object-cover">
                <div id="status-dot" class="absolute bottom-2 right-2 w-6 h-6 rounded-full border-4 border-slate-800 bg-gray-500 z-10"></div>
            </div>

            <div class="text-center md:text-left z-10 flex-1">
                <div class="flex items-center justify-center md:justify-start gap-3 mb-2">
                    <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">Lifesteal Best SMP</h1>
                    <span class="bg-red-500/20 text-red-300 text-xs px-2 py-1 rounded border border-red-500/30 uppercase tracking-wider font-bold">Cracked</span>
                </div>
                <div id="motd" class="text-slate-400 font-mono text-sm mb-4 min-h-[1.5em]">Loading MOTD...</div>
                
                <!-- IP Copy Section -->
                <div class="flex flex-col sm:flex-row gap-3">
                    <button onclick="copyToClipboard('lifestealbestsmp.playsmp.xyz')" 
                            class="group bg-slate-800 hover:bg-slate-700 border border-slate-600 transition-all rounded-lg px-4 py-2 flex items-center justify-between gap-3 min-w-[200px]">
                        <div class="flex flex-col items-start">
                            <span class="text-xs text-slate-400 uppercase font-bold">Java IP</span>
                            <span class="text-emerald-400 font-mono">lifestealbestsmp.playsmp.xyz</span>
                        </div>
                        <i class="fas fa-copy text-slate-500 group-hover:text-white transition-colors"></i>
                    </button>

                    <button onclick="copyToClipboard('25573')" 
                            class="group bg-slate-800 hover:bg-slate-700 border border-slate-600 transition-all rounded-lg px-4 py-2 flex items-center justify-between gap-3">
                        <div class="flex flex-col items-start">
                            <span class="text-xs text-slate-400 uppercase font-bold">Port</span>
                            <span class="text-blue-400 font-mono">25573</span>
                        </div>
                        <i class="fas fa-paste text-slate-500 group-hover:text-white transition-colors"></i>
                    </button>
                </div>
            </div>

            <!-- Basic Status -->
            <div class="flex flex-col gap-2 min-w-[150px] z-10">
                <div class="glass-panel p-3 rounded-xl text-center">
                    <div class="text-xs text-slate-400 uppercase">Status</div>
                    <div id="server-status-text" class="text-xl font-bold text-gray-400">Checking...</div>
                </div>
                <div class="glass-panel p-3 rounded-xl text-center">
                    <div class="text-xs text-slate-400 uppercase">Players</div>
                    <div id="player-count-main" class="text-xl font-bold text-white">-/-</div>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            
            <!-- CPU Card (Pterodactyl) -->
            <div class="glass-panel rounded-2xl p-6 relative overflow-hidden group">
                <div class="absolute -right-4 -top-4 text-slate-700/30 group-hover:text-slate-700/50 transition-colors">
                    <i class="fas fa-microchip text-8xl"></i>
                </div>
                <h3 class="text-slate-400 text-sm font-semibold uppercase mb-1">CPU Load</h3>
                <div class="flex items-end gap-2 mb-2">
                    <span id="cpu-val" class="text-3xl font-bold text-white">0%</span>
                    <span class="text-sm text-slate-500 mb-1">utilization</span>
                </div>
                <div class="w-full bg-slate-700/50 rounded-full h-2 overflow-hidden">
                    <div id="cpu-bar" class="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <p class="text-xs text-slate-500 mt-2" id="pterodactyl-status-cpu">Waiting for panel...</p>
            </div>

            <!-- RAM Card (Pterodactyl) -->
            <div class="glass-panel rounded-2xl p-6 relative overflow-hidden group">
                <div class="absolute -right-4 -top-4 text-slate-700/30 group-hover:text-slate-700/50 transition-colors">
                    <i class="fas fa-memory text-8xl"></i>
                </div>
                <h3 class="text-slate-400 text-sm font-semibold uppercase mb-1">Memory</h3>
                <div class="flex items-end gap-2 mb-2">
                    <span id="ram-val" class="text-3xl font-bold text-white">0 MB</span>
                    <span class="text-sm text-slate-500 mb-1">used</span>
                </div>
                <div class="w-full bg-slate-700/50 rounded-full h-2 overflow-hidden">
                    <div id="ram-bar" class="bg-gradient-to-r from-emerald-500 to-teal-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <p class="text-xs text-slate-500 mt-2" id="ram-limit">Limit: Calculating...</p>
            </div>

            <!-- Disk Card (Pterodactyl) -->
            <div class="glass-panel rounded-2xl p-6 relative overflow-hidden group">
                <div class="absolute -right-4 -top-4 text-slate-700/30 group-hover:text-slate-700/50 transition-colors">
                    <i class="fas fa-hdd text-8xl"></i>
                </div>
                <h3 class="text-slate-400 text-sm font-semibold uppercase mb-1">Disk</h3>
                <div class="flex items-end gap-2 mb-2">
                    <span id="disk-val" class="text-3xl font-bold text-white">0 MB</span>
                    <span class="text-sm text-slate-500 mb-1">used</span>
                </div>
                <div class="w-full bg-slate-700/50 rounded-full h-2 overflow-hidden">
                    <div id="disk-bar" class="bg-gradient-to-r from-orange-500 to-amber-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <p class="text-xs text-slate-500 mt-2" id="disk-limit">Limit: Calculating...</p>
            </div>
        </div>

        <!-- Players List Section -->
        <div class="glass-panel rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center gap-2">
                    <i class="fas fa-users text-slate-400"></i> Online Players
                </h3>
                <span id="player-count-detail" class="bg-slate-700/50 px-3 py-1 rounded-full text-sm font-mono text-slate-300">
                    0 Online
                </span>
            </div>

            <div id="player-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <!-- Players injected here -->
                <div class="col-span-full text-center py-8 text-slate-500 italic">
                    Scanning for players...
                </div>
            </div>
        </div>

        <div class="mt-8 text-center text-slate-600 text-sm">
            <p>Data provided by Pterodactyl Panel & mcsrvstat.us</p>
            <p class="text-xs mt-1 opacity-50">Note: If CPU/RAM show 0 or Error, your browser may be blocking direct access to the panel API.</p>
        </div>

    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-emerald-600 text-white px-6 py-3 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-3">
        <i class="fas fa-check-circle"></i>
        <span id="toast-msg">Copied!</span>
    </div>

    <script>
        // CONFIGURATION
        const PTERODACTYL_API = "https://panel.overnode.fr/api/client";
        const SERVER_ID = "7d67a4c7";
        const API_KEY = "ptlc_Rq6lcQ27OOxeO3V0r6z9kATHqcRkBCzbOIDzNXLimaV"; // WARNING: Client-side exposure
        const SERVER_IP = "lifestealbestsmp.playsmp.xyz";
        const SERVER_PORT = "25573";

        // Utility: Copy to Clipboard
        function copyToClipboard(text) {
            const tempInput = document.createElement("input");
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            
            // Show toast
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = `Copied: ${text}`;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // 1. Fetch Public Stats (mcsrvstat.us)
        // This is robust and handles player lists, icons, and basic online state best for public pages.
        async function fetchPublicStats() {
            try {
                const response = await fetch(`https://api.mcsrvstat.us/2/${SERVER_IP}:${SERVER_PORT}`);
                const data = await response.json();

                // Status Dot & Text
                const dot = document.getElementById('status-dot');
                const statusText = document.getElementById('server-status-text');
                
                if (data.online) {
                    dot.classList.remove('bg-gray-500', 'bg-red-500');
                    dot.classList.add('bg-emerald-500', 'animate-pulse');
                    statusText.innerText = "Online";
                    statusText.classList.remove('text-gray-400', 'text-red-400');
                    statusText.classList.add('text-emerald-400');
                } else {
                    dot.classList.remove('bg-emerald-500', 'animate-pulse');
                    dot.classList.add('bg-red-500');
                    statusText.innerText = "Offline";
                    statusText.classList.add('text-red-400');
                }

                // Header Info
                if (data.icon) document.getElementById('server-icon').src = data.icon;
                
                // Parse MOTD (Simple cleanup of color codes for HTML)
                if (data.motd && data.motd.html) {
                    document.getElementById('motd').innerHTML = data.motd.html.join('<br>');
                }

                // Players
                const online = data.players.online;
                const max = data.players.max;
                document.getElementById('player-count-main').innerText = `${online} / ${max}`;
                document.getElementById('player-count-detail').innerText = `${online} / ${max} Online`;

                // Render Player List
                const playerList = document.getElementById('player-list');
                playerList.innerHTML = ''; // Clear loading

                if (data.players.list && data.players.list.length > 0) {
                    data.players.list.forEach(player => {
                        // Sometimes player is just string, sometimes object
                        const name = typeof player === 'string' ? player : player.name;
                        // Use Minotar or similar for skin
                        const skinUrl = `https://minotar.net/helm/${name}/64.png`;
                        
                        const playerCard = `
                            <div class="bg-slate-800/50 p-3 rounded-xl flex items-center gap-3 border border-slate-700 hover:bg-slate-700/80 transition-colors">
                                <img src="${skinUrl}" class="w-8 h-8 rounded-lg" onerror="this.src='https://via.placeholder.com/32'">
                                <span class="text-sm font-medium text-slate-200 truncate">${name}</span>
                            </div>
                        `;
                        playerList.innerHTML += playerCard;
                    });
                } else {
                    if (data.online) {
                        playerList.innerHTML = `<div class="col-span-full text-center py-4 text-slate-500">No players online right now. Join in!</div>`;
                    } else {
                        playerList.innerHTML = `<div class="col-span-full text-center py-4 text-red-500">Server is offline.</div>`;
                    }
                }

            } catch (error) {
                console.error("Public stats error:", error);
                document.getElementById('server-status-text').innerText = "API Error";
            }
        }

        // 2. Fetch Pterodactyl Resources (Memory/CPU/Disk)
        // Note: This often hits CORS issues on static pages.
        async function fetchPterodactylStats() {
            try {
                const response = await fetch(`${PTERODACTYL_API}/servers/${SERVER_ID}/resources`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });

                if (!response.ok) throw new Error(`Status: ${response.status}`);

                const json = await response.json();
                const stats = json.attributes.resources;
                
                // Helper to format bytes
                const formatBytes = (bytes, decimals = 1) => {
                    if (bytes === 0) return '0 B';
                    const k = 1024;
                    const dm = decimals < 0 ? 0 : decimals;
                    const sizes = ['B', 'MB', 'GB', 'TB'];
                    // Pterodactyl returns bytes for some, MB for others. 
                    // Usually memory_bytes, disk_bytes.
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
                };

                // CPU
                const cpuVal = stats.cpu_absolute.toFixed(1);
                document.getElementById('cpu-val').innerText = `${cpuVal}%`;
                document.getElementById('cpu-bar').style.width = `${Math.min(cpuVal, 100)}%`;
                // Colorize CPU bar based on load
                const cpuBar = document.getElementById('cpu-bar');
                if(cpuVal > 80) cpuBar.className = "bg-red-500 h-2 rounded-full transition-all duration-500";
                else if(cpuVal > 50) cpuBar.className = "bg-yellow-500 h-2 rounded-full transition-all duration-500";
                else cpuBar.className = "bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-500";
                
                document.getElementById('pterodactyl-status-cpu').innerText = "Live from Panel";
                document.getElementById('pterodactyl-status-cpu').classList.add('text-emerald-500');

                // RAM
                // Pterodactyl usually returns memory_bytes
                const ramUsedBytes = stats.memory_bytes;
                // We need the limit to calculate percentage. The Client API resources endpoint doesn't always give the limit
                // We assume a standard limit or try to fetch meta if available.
                // For now, let's just show raw usage formatted.
                // If we want percentage, we need to know the server plan (e.g., 4GB).
                // I will try to infer context or just display Used amount prominently.
                
                // To display percentage properly we need server details from /servers/{id}
                // But let's just format the usage first.
                const ramFormatted = formatBytes(ramUsedBytes);
                // Assume 16GB limit for visualization scaling roughly, or just fill relative to generic
                // Or better, fetch server info once.
                
                document.getElementById('ram-val').innerText = ramFormatted;
                // Let's assume 8GB for the bar visual just so it moves, or use the disk logic
                
                // Disk
                const diskUsedBytes = stats.disk_bytes;
                document.getElementById('disk-val').innerText = formatBytes(diskUsedBytes);

                // Fetch Limits separately to make bars accurate
                fetchServerDetails(stats);

            } catch (error) {
                console.warn("Pterodactyl CORS/Auth Error:", error);
                document.getElementById('pterodactyl-status-cpu').innerText = "Restricted (CORS)";
                document.getElementById('pterodactyl-status-cpu').classList.add('text-red-400');
            }
        }

        async function fetchServerDetails(currentStats) {
            try {
                const response = await fetch(`${PTERODACTYL_API}/servers/${SERVER_ID}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });
                const json = await response.json();
                const limits = json.attributes.limits;

                // Update RAM Bar
                const ramLimitBytes = limits.memory * 1024 * 1024; // MB to Bytes
                if (ramLimitBytes > 0) {
                    const ramPct = (currentStats.memory_bytes / ramLimitBytes) * 100;
                    document.getElementById('ram-bar').style.width = `${Math.min(ramPct, 100)}%`;
                    document.getElementById('ram-limit').innerText = `Limit: ${limits.memory} MB`;
                } else {
                    document.getElementById('ram-limit').innerText = `Limit: Unlimited`;
                }

                // Update Disk Bar
                const diskLimitBytes = limits.disk * 1024 * 1024;
                if (diskLimitBytes > 0) {
                    const diskPct = (currentStats.disk_bytes / diskLimitBytes) * 100;
                    document.getElementById('disk-bar').style.width = `${Math.min(diskPct, 100)}%`;
                    document.getElementById('disk-limit').innerText = `Limit: ${limits.disk} MB`;
                } else {
                    document.getElementById('disk-limit').innerText = `Limit: Unlimited`;
                }

            } catch (e) {
                console.log("Could not fetch limits");
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchPublicStats();
            fetchPterodactylStats();

            // Auto-refresh stats every 10 seconds
            setInterval(() => {
                fetchPublicStats();
                fetchPterodactylStats();
            }, 10000);
        });

    </script>
</body>
</html>
